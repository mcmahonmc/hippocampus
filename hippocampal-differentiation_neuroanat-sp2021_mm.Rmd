---
title: "Sleep and Hippocampal Differentiation in Healthy Older and Younger Adults"
author: "Megan McMahon"
date: "4/2/2021"
output:
  prettydoc::html_pretty:
    theme: leonids
    highlight: github
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(corrr)
library(gridExtra)
library(reshape2)
library(tableone)

df <- read.csv("~/Box/CogNeuroLab/Aging Decision Making R01/data/dataset_2020-10-10.csv")
vol <- read.csv("/Volumes/schnyer/Megan/hippocampal-differentiation_neuroanat_spring-2021/proj-6051536f38fe127a89efe276/stats_vol_full.csv")

vol$record_id <- substr(vol$Subject, 5, 10)

d <- merge(df, vol, by = 'record_id')

d$Group <- factor(d$Group, levels = c("Young Adults", "Older Adults"))
d$sleepundersix <- factor(ifelse(d$sleep_time_mean_sleep < 360, "Under 6 h", "At least 6 h"))
```


```{r cvlt, include=FALSE, warning=FALSE}

d %>%
  select(matches("cvlt"))

```

## Introduction: Hippocampal differentiation

- The hippocampus shows a long axis anterior-posterior differentiation of function
- Poppenk et al. (2013) suggested that the type of processing in the hippocampus varied from fine to coarse grained in a posterior to anterior direction, based on evidence that receptive fields vary from narrow at the posterior end of the hippocampus to broad at the anterior end (Kjelstrup et al., 2008; Maurer, Vanrhoads, Sutherland, Lipa, & McNaughton, 2005). 
- Anterior = pattern completion, posterior = pattern separation 

![Grady et al., 2020](/Volumes/schnyer/Megan/hippocampal-differentiation_neuroanat_spring-2021/grady.png)

![](/Volumes/schnyer/Megan/hippocampal-differentiation_neuroanat_spring-2021/grady_neurosynth.png)
- The anterior and posterior portions may undergo different developmental trajectories across the lifespan, and may give rise to some of the cognitive changes that commonly accompany the aging process (i.e., episodic memory)


![Langnes et al., 2020](/Volumes/schnyer/Megan/hippocampal-differentiation_neuroanat_spring-2021/Langnes_2020.jpeg)

![](/Volumes/schnyer/Megan/hippocampal-differentiation_neuroanat_spring-2021/langnes_2.png)
## Sleep and the hippocampus

- Hippocampus involved in sleep architecture (theta in REM, sharp wave ripples in NREM, coupling with slow wave)
- Chronic sleep disruption and circadian rhythmicity affect hippocampal neurogenesis in animals (Raven et al., 2018; Kreutzmann et al., 2015)
- In older adults, more robust rest-activity rhythms were associated with greater anterior hippocampal volume (Sherman et al., 2015)
- Sleep disturbance in older adults predicts increasingly worse scores on standardized neuropsychological tests, including memory subcomponents that depend upon the hippocampus (HVLT)

## Research Question 

Are sleep-wake patterns associated with volumetric differences along the hippocampal long axis that underlie episodic memory? 

## Methods
- Healthy younger (n = `r format(count(d[d$Group == "Young Adults",]), digits = 3)`, age = `r format(mean(d$age[d$Group == "Young Adults"]), digits = 3)`, ±`r format(sd(d$age[d$Group == "Young Adults"]), digits = 3)`) and older (n = `r format(count(d[d$Group == "Young Adults",]), digits = 3)`, age = `r format(mean(d$age[d$Group == "Older Adults"]), digits = 3)`, ±`r format(sd(d$age[d$Group == "Older Adults"]), digits = 3)`) adults
- Actigraphy
- fMRI scanning
- Episodic memory measures: associative memory task, CVLT (older adults only)
- Working memory/novelty measure: repeat task

## Actigraphy
- Selected mean sleep duration, acrophase, amplitude, and interdaily stability as measures of interest


![](/Volumes/schnyer/Megan/hippocampal-differentiation_neuroanat_spring-2021/McMahon_2020_CR_ex.jpeg)
- Planned to use CVLT, but did not have data available from younger adults :(


![CVLT](/Volumes/schnyer/Megan/hippocampal-differentiation_neuroanat_spring-2021/CVLT.jpeg)


### Associative memory task
- Had associative memory task data, but really only have a good measure of intial encoding and short-term recall (no long-term recall measure)
- This is problematic because really wanted long-term recall measure ([Langnes et al. 2020](10.1002/hipo.23189))


![](/Volumes/schnyer/Megan/hippocampal-differentiation_neuroanat_spring-2021/amemtask.png)


## Repeat task
- 1-back working memory task
- Novelty vs. familiarity
![](/Volumes/schnyer/Megan/hippocampal-differentiation_neuroanat_spring-2021/repeat_task.png)

## Participants

```{r demo, include = FALSE, warnings = FALSE}
myVars <- c('Group', 'age', 'sex', 'years_educ', 'global_psqi', 'cesd_score', 'gds_total', 'sleep_time_mean_sleep', 'efficiency_mean_sleep', 'total_ac_mean_active', 'actamp', 'IS', 'actphi')

catVars <- c('Group', 'sex')

tab1 <- CreateTableOne(vars = myVars, strata = 'Group' , data = d, factorVars = catVars)

```

```{r, echo = FALSE}
kableone(print(tab1, cramVars=TRUE, test = FALSE))

```


## Parcellation
- Used brainlife.io to obtain hippocampal volume measures
- Uploaded [BIDS dataset](https://brainlife.io/project/6051536f38fe127a89efe276/dataset/)


![brainlife.io](/Volumes/schnyer/Megan/hippocampal-differentiation_neuroanat_spring-2021/Brainlife_Aging_Study.jpeg)
- Checked orientation of all T1 images
- Ran ACPC alignment

### Originial T1:
![T1](/Volumes/schnyer/Megan/hippocampal-differentiation_neuroanat_spring-2021/t1.png)


### ACPC aligned:
![ACPC alignment](/Volumes/schnyer/Megan/hippocampal-differentiation_neuroanat_spring-2021/acpc.png)

- Used "HBT" divisions ([Iglesias et al., 2015](https://doi.org/10.1016/j.neuroimage.2015.04.042))
- This parcellation was based on both ex vivo and in vivo data


![Manual labelling](/Volumes/schnyer/Megan/hippocampal-differentiation_neuroanat_spring-2021/1-s2.0-S1053811915003420-gr2.jpg)


![In vivo segmentation](1-s2.0-S1053811915003420-gr3.jpg)


![Hippocampal parcellation](/Volumes/schnyer/Megan/hippocampal-differentiation_neuroanat_spring-2021/FS_HC_Parcellation.jpeg)

## Results
## Aging and hippocampal volume

```{r, echo = FALSE, warning=FALSE}

d$Hippocampus <- d$Left.Hippocampus + d$Right.Hippocampus
d$Hippocampal_tail <- d$Left.Hippocampal_tail + d$Right.Hippocampal_tail
d$Hippocampal_head <- d$Left.Whole_hippocampal_head + d$Right.Whole_hippocampal_head

d %>%
  rename(`Head` = Hippocampal_head) %>%
  rename(`Tail` = Hippocampal_tail) %>%
  rename(`Total` = Hippocampus) %>%
  melt(id.vars = c('record_id', 'Group', 'age'), measure.vars = c('Total', 'Head', 'Tail'), variable.name = 'Hippocampal region', value.name = 'Hippocampal volume') %>%
  ggplot(aes(x = age, y = `Hippocampal volume`, group = Group, color = Group)) +
  geom_point() + 
  stat_smooth(method = "loess", formula = 'y ~ x') +
  scale_color_brewer(palette = 'Set1') + theme_minimal() + 
  facet_wrap(. ~ `Hippocampal region`, scales = 'free') + 
  theme(legend.position="none") +
  theme_minimal() +
  ggsave('~/Desktop/vol_no-icv.png', height = 5, width = 12, units = 'in', dpi=300)

```

```{r icv_norm, include = FALSE, warning=FALSE}
ICVnorm <- function(d, x){
  
  f <- paste(x, "~ EstimatedTotalIntraCranialVol")
  b <- as.numeric((lm(f, d))$coefficients[2])
  d[x] = d[x] - b * (d$EstimatedTotalIntraCranialVol - mean(d$EstimatedTotalIntraCranialVol, na.rm = TRUE))
  
  return(d)
}

cols <- names(d[,grepl("hippoc|Hippoc|CA", names(d))])

for (col in cols){
  d <- ICVnorm(d, col)
}

```

### ICV normalized 

We wanted to look at hippocampal volume independently of total intracranial volume, so we calculated HC volume as follows: adjusted HC volume = raw HC volume – b X (ICV – average ICV), where b is the slope of regression of the raw HC volume on ICV ([Brehmer et al., 2020](https://doi.org/10.1016/j.neuroimage.2019.116475)).

```{r icv_norm_plots, echo = FALSE, warning = FALSE}

d$Hippocampus <- d$Left.Hippocampus + d$Right.Hippocampus
d$Hippocampal_tail <- d$Left.Hippocampal_tail + d$Right.Hippocampal_tail
d$Hippocampal_head <- d$Right.Whole_hippocampal_head + d$Left.Whole_hippocampal_head

d %>%
  rename(`Head` = Hippocampal_head) %>%
  rename(`Tail` = Hippocampal_tail) %>%
  rename(`Total` = Hippocampus) %>%
  melt(id.vars = c('record_id', 'Group', 'age'), measure.vars = c('Total', 'Head', 'Tail'), variable.name = 'Hippocampal region', value.name = 'Hippocampal volume') %>%
  ggplot(aes(x = age, y = `Hippocampal volume`, group = Group, color = Group)) +
  geom_point() + 
  stat_smooth(method = "loess", formula = 'y ~ x') +
  scale_color_brewer(palette = 'Set1') + theme_minimal() + 
  facet_wrap(. ~ `Hippocampal region`, scales = 'free') + 
  theme(legend.position="none") +
  theme_minimal() +
  ggsave('~/Desktop/vol_icv.png', height = 5, width = 12, units = 'in', dpi=300)

```

```{r read_mem_data, include = FALSE, warning=FALSE}
mem <- read.csv('/Users/mcmahonmc/Box/CogNeuroLab/Aging Decision Making R01/Data/memmatch_learning_results_mean.csv', col.names = c('phase', 'record_id', 'acc_mean', 'acc_std', 'rt_mean', 'rt_std', 'rt_c_mean', 'rt_c_std'), skip = 2)

mem$rt_mean[mem$phase == 'test'] <- mem$rt_mean[mem$phase == 'test'] - 9000
mem$rt_c_mean[mem$phase == 'test'] <- mem$rt_c_mean[mem$phase == 'test'] - 9000

memrepeat <- read.csv('~/Box/CogNeuroLab/Aging Decision Making R01/data/memrepeat_results_means.csv')

memcond <- read_csv('~/Box/CogNeuroLab/Aging Decision Making R01/data/memmatch_results_by_cond.csv')
memcond$cond <- factor(memcond$cond, labels = c("face_match", "face_mismatch", "scene_match", "scene_mismatch"))
colnames(memcond) <- c("record_id", "cond", "rt", "accuracy", "rt_c")
memcond$rt_c <- memcond$rt_c - 9000
memcond$rt <- memcond$rt - 9000

memcondwide <- memcond %>%
  pivot_wider(
    id_cols = record_id,
    names_from = cond,
    names_sep = ".",
    values_from = c(rt, accuracy, rt_c)
  )
memcondwide$accuracy.face <- (memcondwide$accuracy.face_match +  memcondwide$accuracy.face_mismatch)/2
memcondwide$accuracy.scene <- (memcondwide$accuracy.scene_match +  memcondwide$accuracy.scene_mismatch)/2

memcondwide$accuracy.match <- (memcondwide$accuracy.face_match +  memcondwide$accuracy.scene_match)/2
memcondwide$accuracy.mismatch <- (memcondwide$accuracy.face_mismatch +  memcondwide$accuracy.scene_mismatch)/2

memcondwide$rt_c.face <- (memcondwide$rt_c.face_match +  memcondwide$rt_c.face_mismatch)/2
memcondwide$rt_c.scene <- (memcondwide$rt_c.scene_match +  memcondwide$rt_c.scene_mismatch)/2

memcondwide$rt_c.match <- (memcondwide$rt_c.face_match +  memcondwide$rt_c.scene_match)/2
memcondwide$rt_c.mismatch <- (memcondwide$rt_c.face_mismatch +  memcondwide$rt_c.scene_mismatch)/2

memcondwide$rt.face <- (memcondwide$rt.face_match +  memcondwide$rt.face_mismatch)/2
memcondwide$rt.scene <- (memcondwide$rt.scene_match +  memcondwide$rt.scene_mismatch)/2

memcondwide$rt.match <- (memcondwide$rt.face_match +  memcondwide$rt.scene_match)/2
memcondwide$rt.mismatch <- (memcondwide$rt.face_mismatch +  memcondwide$rt.scene_mismatch)/2

memwide <- mem %>%
  pivot_wider(
    id_cols = record_id,
    names_from = phase,
    names_sep = ".",
    values_from = c(acc_mean, acc_std, rt_mean, rt_std, rt_c_mean, rt_c_std)
  )

```

```{r correlations, include = FALSE, warning=FALSE}

d %>%
  filter(Group == "Older Adults") %>%
  select(matches("hippocampal_tail|hippocampal_head"), cvlt_1, cvlt_sdelay_recall, cvlt_ldelay_recall, cvlt_sdelay_cued_recall, cvlt_ldelay_cue_recall, cvlt_ldelay_recall_zscore, cvlt_sdelay_recall_zscore, cvlt_recognition_hits_zscore, cvlt_recognition_fp_zscore) %>%
  correlate() %>%
  rplot(print_cor = TRUE) + theme(axis.text.x = element_text(angle = 90))

#all
d %>%
  select(matches("hippocampal_tail|hippocampal_head"), actamp, IS, IV, RA, sleep_time_mean_sleep, total_ac_mean_active) %>%
  correlate() %>%
  rplot(print_cor = TRUE) + theme(axis.text.x = element_text(angle = 90))


#older
d %>%
  filter(Group == "Older Adults") %>%
  select(matches("hippocampal_tail|hippocampal_head"), actamp, IS, IV, RA, sleep_time_mean_sleep, total_ac_mean_active) %>%
  correlate() %>%
  rplot(print_cor = TRUE) + theme(axis.text.x = element_text(angle = 90))

#younger
d %>%
  filter(Group == "Young Adults") %>%
  select(matches("hippocampal_tail|hippocampal_head"), actamp, IS, IV, RA, sleep_time_mean_sleep, total_ac_mean_active) %>%
  correlate() %>%
  rplot(print_cor = TRUE) + theme(axis.text.x = element_text(angle = 90))

d %>%
  select(matches("hippocampal_tail|hippocampal_head"), rt_mean) %>%
  correlate() %>%
  rplot(print_cor = TRUE) + theme(axis.text.x = element_text(angle = 90))

d %>%
  filter(Group == "Older Adults") %>%
  select(matches("Right.CA|Left.CA"), actamp, IS, IV, RA, sleep_time_mean_sleep, total_ac_mean_active) %>%
  correlate() %>%
  rplot(print_cor = TRUE) + theme(axis.text.x = element_text(angle = 90))

d %>%
  filter(Group == "Young Adults") %>%
  select(matches("Right.CA|Left.CA"), actamp, IS, IV, RA, sleep_time_mean_sleep, total_ac_mean_active) %>%
  correlate() %>%
  rplot(print_cor = TRUE) + theme(axis.text.x = element_text(angle = 90))
```


```{r, include = FALSE, warning=FALSE}
memwide[] <- lapply(memwide, function(x) as.numeric(as.character(x)))

dmem <- merge(d, memwide, by = 'record_id')
dmem <- merge(dmem, memrepeat, by = 'record_id')
dmem$memrepeat_accuracy <- dmem$memrepeat_accuracy /100
dmem <- merge(dmem, memcondwide, by = 'record_id')

#all
dmem %>%
  #filter(Group == "Young Adults") %>%
  select(matches("hippocampal_tail|hippocampal_head"), acc_mean.learning, acc_mean.test) %>%
  correlate() %>%
  rplot(print_cor = TRUE) + theme(axis.text.x = element_text(angle = 90))

#oa
dmem %>%
  filter(Group == "Older Adults") %>%
  select(matches("hippocampal_tail|hippocampal_head"), acc_mean.learning, acc_mean.test) %>%
  correlate() %>%
  rplot(print_cor = TRUE) + theme(axis.text.x = element_text(angle = 90))

#ya
dmem %>%
  filter(Group == "Young Adults") %>%
  select(matches("hippocampal_tail|hippocampal_head"), acc_mean.learning, acc_mean.test) %>%
  correlate() %>%
  rplot(print_cor = TRUE) + theme(axis.text.x = element_text(angle = 90))
```

## Memory Performance

```{r, include = FALSE, echo= FALSE, warning = FALSE}
myVars2 <- c('Group', 'cvlt_sdelay_recall_zscore', 'cvlt_ldelay_recall_zscore', 'cvlt_recognition_hits_zscore','cvlt_recognition_fp_zscore', 'cvlt_zscore', 'acc_mean.learning', 'rt_c_mean.learning', 'acc_mean.test', 'rt_c_mean.test', 'memrepeat_accuracy', 'memrepeat_rt')

tab2 <- CreateTableOne(vars = myVars2, strata = 'Group' , data = dmem, factorVars = catVars)
```

```{r, echo = FALSE}
kableone(print(tab2, cramVars=TRUE, test = FALSE))
```

```{r}
dmem %>%
  select(record_id, acc_mean.learning, acc_mean.test) %>%
  filter((acc_mean.learning < 0.33)|(acc_mean.test < 0.50))

dmem <- dmem %>%
  filter(acc_mean.learning > 0.33)
```

## Hippocampal volume and CVLT performance within older adults
- Only had CVLT data for older adults
- Did not see relationship between hippocampal volume and CVLT memory

```{r, echo = FALSE, warning=FALSE}

dmem %>%
  filter(acc_mean.test > 0.50) %>%
  filter(memrepeat_accuracy > 0.50) %>%
  filter(acc_mean.learning > 0.33) %>%
  rename(`Head` = Hippocampal_head) %>%
  rename(`Tail` = Hippocampal_tail) %>%
  melt(id.vars = c('record_id', 'Group', 'cvlt_1', 'cvlt_sdelay_recall', 'cvlt_ldelay_recall', 'cvlt_recognition_hits'), measure.vars = c('Head', 'Tail'), variable.name = 'Hippocampal region', value.name = 'Hippocampal subregion volume') %>%
  melt(id.vars = c('record_id', 'Group', 'Hippocampal region', 'Hippocampal subregion volume', 'cvlt_1', 'cvlt_sdelay_recall', 'cvlt_ldelay_recall', 'cvlt_recognition_hits'), measure.vars = c('cvlt_1', 'cvlt_sdelay_recall', 'cvlt_ldelay_recall', 'cvlt_recognition_hits'), variable.name = 'CVLT Measure', value.name = 'Raw Score') %>%
  ggplot(aes(x = `Hippocampal subregion volume`, y = `Raw Score`, group = Group, color = Group)) +
  geom_point() + 
  stat_smooth(method = "lm", formula = 'y ~ x') +
  scale_color_brewer(palette = 'Set1') + theme_minimal() + theme(legend.position = "none") +
  facet_grid(`Hippocampal region` ~ `CVLT Measure`, scales = 'free_x', space = "free") + 
  ylab("Raw Score") + ggtitle("Hippocampal subregion volume and CVLT performance")

```

## Sleep and CVLT performance

```{r, echo = FALSE, warning=FALSE}

dmem %>%
  melt(id.vars = c('record_id', 'Group', 'cvlt_1', 'cvlt_sdelay_recall', 'cvlt_ldelay_recall', 'cvlt_recognition_hits', 'sleep_time_mean_sleep', 'actphi'), measure.vars = c('cvlt_1', 'cvlt_sdelay_recall', 'cvlt_ldelay_recall', 'cvlt_recognition_hits'), variable.name = 'CVLT Measure', value.name = 'Raw Score') %>%
  ggplot(aes(x = actphi, y = `Raw Score`, group = Group, color = Group)) +
  geom_point() + 
  stat_smooth(method = "lm", formula = 'y ~ x') +
  facet_grid(. ~ `CVLT Measure`, scales = 'free') + 
  scale_color_brewer(palette = 'Set1') + theme_minimal() + 
  xlab("Acrophase")

```

## Hippocampal volume and associative memory task performance

- Using the associative memory task allowed us to include the young adult comparison group.
- There was a significant Group by hippocampal head volume effect on associative memory accuracy during the test phase, where older adults showed a positive association between hippocampal head volume and memory accuracy, whereas young adults showed the opposite trend.

```{r, echo = FALSE, warning = FALSE}

dmem %>%
  filter(acc_mean.test > 0.50) %>%
  filter(memrepeat_accuracy > 0.50) %>%
  filter(acc_mean.learning > 0.33) %>%
  ggplot(aes(x = Hippocampal_head, y = acc_mean.test, group = Group, color = Group)) +
  geom_point() + 
  stat_smooth(method = "lm", formula = 'y ~ x') +
  scale_color_brewer(palette = 'Set1') + theme_minimal() 

dmem %>%
  filter(acc_mean.test > 0.50) %>%
  filter(memrepeat_accuracy > 0.50) %>%
  filter(acc_mean.learning > 0.33) %>%
  rename(`Head` = Hippocampal_head) %>%
  rename(`Tail` = Hippocampal_tail) %>%
  melt(id.vars = c('record_id', 'Group', 'Head', 'Tail'), measure.vars = c('acc_mean.learning', 'acc_mean.test', 'memrepeat_accuracy'), variable.name = 'Task Phase', value.name = 'Accuracy') %>%
  melt(id.vars = c('record_id', 'Group', 'Task Phase', 'Accuracy'), measure.vars = c('Head', 'Tail'), variable.name = 'Hippocampal region', value.name = 'Hippocampal subregion volume') %>%
  mutate(`Task Phase` =  factor(`Task Phase`, labels = c("Learning", "Test", "Repeat"))) %>%
  ggplot(aes(x = `Hippocampal subregion volume`, y = Accuracy, group = Group, color = Group)) +
  geom_point() + 
  stat_smooth(method = "lm", formula = 'y ~ x') +
  facet_grid(`Hippocampal region` ~ `Task Phase`, scales = 'free') + 
  scale_color_brewer(palette = 'Set1') + theme_minimal() 

dmem %>%
  filter(acc_mean.test > 0.50) %>%
  filter(memrepeat_accuracy > 0.50) %>%
  filter(acc_mean.learning > 0.33) %>%
  rename(`Head` = Hippocampal_head) %>%
  rename(`Tail` = Hippocampal_tail) %>%
  melt(id.vars = c('record_id', 'Group', 'Head', 'Tail'), measure.vars = c('rt_c_mean.learning', 'rt_c_mean.test', 'memrepeat_rt'), variable.name = 'Task Phase', value.name = 'Response Time') %>%
  melt(id.vars = c('record_id', 'Group', 'Task Phase', 'Response Time'), measure.vars = c('Head', 'Tail'), variable.name = 'Hippocampal region', value.name = 'Hippocampal subregion volume') %>%
  mutate(`Task Phase` =  factor(`Task Phase`, labels = c("Learning", "Test", "Repeat"))) %>%
  ggplot(aes(x = `Hippocampal subregion volume`, y = `Response Time`, group = Group, color = Group)) +
  geom_point() + 
  stat_smooth(method = "lm", formula = 'y ~ x') +
  facet_grid(`Hippocampal region` ~ `Task Phase`, scales = 'free') + 
  scale_color_brewer(palette = 'Set1') + theme_minimal() 


```

## Sleep and memory performance
- In this study, young and older adult age groups showed differential relationships between acrophase and (1) accuracy during the test phase, and (2) response time on correct trials during both the learning and test phases

```{r, echo = FALSE, warning = FALSE}
dmem %>%
  melt(id.vars = c('record_id', 'Group', 'acc_mean.learning', 'acc_mean.test', 'memrepeat_accuracy', 'sleep_time_mean_sleep', 'actphi'), measure.vars = c('acc_mean.learning', 'acc_mean.test', 'memrepeat_accuracy'), variable.name = 'Task Phase', value.name = 'Accuracy') %>%
  mutate(`Task Phase` =  factor(`Task Phase`, labels = c("Learning", "Test", "Repeat"))) %>%
  ggplot(aes(x = actphi, y = Accuracy, group = Group, color = Group)) +
  geom_point() + 
  stat_smooth(method = "lm", formula = 'y ~ x') +
  facet_grid(. ~ `Task Phase`, scales = 'free') + 
  scale_color_brewer(palette = 'Set1') + theme_minimal() + 
  xlab("Acrophase")

dmem %>%
  filter(sleep_time_mean_sleep < 700) %>%
  filter(rt_c_mean.learning < 6000) %>%
  melt(id.vars = c('record_id', 'Group', 'rt_c_mean.learning', 'rt_c_mean.test', 'memrepeat_rt', 'sleep_time_mean_sleep', 'actphi'), measure.vars = c('rt_c_mean.learning', 'rt_c_mean.test', 'memrepeat_rt'), variable.name = 'Task Phase', value.name = 'Response Time') %>%
  mutate(`Task Phase` =  factor(`Task Phase`, labels = c("Learning", "Test", "Repeat"))) %>%
  ggplot(aes(x = actphi, y = `Response Time`, group = Group, color = Group)) +
  geom_point() + 
  stat_smooth(method = "lm", formula = 'y ~ x') +
  facet_grid(. ~ `Task Phase`, scales = 'free') + 
  scale_color_brewer(palette = 'Set1') + theme_minimal() + 
  xlab("Acrophase")

```

## Hippocampal volume and sleep 

- Nada!

```{r, echo = FALSE, warning = FALSE}

dmem %>%
  filter(sleep_time_mean_sleep < 700) %>%
  rename(`Head` = Hippocampal_head) %>%
  rename(`Tail` = Hippocampal_tail) %>%
  rename(`Sleep duration` = sleep_time_mean_sleep) %>%
  rename(`Acrophase` = actphi) %>%
  melt(id.vars = c('record_id', 'Group', 'IS', 'Sleep duration', 'Acrophase'), measure.vars = c('Head', 'Tail'), variable.name = 'Hippocampal region', value.name = 'Hippocampal subregion volume') %>%
  ggplot(aes(x = `Sleep duration`, y = `Hippocampal subregion volume`, group = Group, color = Group)) +
  geom_point() + 
  stat_smooth(method = "lm", formula = 'y ~ x') +
  scale_color_brewer(palette = 'Set1') + theme_minimal() + 
  facet_grid(. ~ `Hippocampal region`, scales = 'free') + 
  theme(legend.position="none") +
  theme_minimal()

dmem %>%
  filter(sleep_time_mean_sleep < 700) %>%
  rename(`Head` = Hippocampal_head) %>%
  rename(`Tail` = Hippocampal_tail) %>%
  rename(`Sleep duration` = sleep_time_mean_sleep) %>%
  rename(`Acrophase` = actphi) %>%
  melt(id.vars = c('record_id', 'Group', 'IS', 'Sleep duration', 'Acrophase'), measure.vars = c('Head', 'Tail'), variable.name = 'Hippocampal region', value.name = 'Hippocampal subregion volume') %>%
  ggplot(aes(x = IS, y = `Hippocampal subregion volume`, group = Group, color = Group)) +
  geom_point() + 
  stat_smooth(method = "lm", formula = 'y ~ x') +
  scale_color_brewer(palette = 'Set1') + theme_minimal() + 
  facet_grid(. ~ `Hippocampal region`, scales = 'free') + 
  theme(legend.position="none") +
  theme_minimal()

dmem %>%
  filter(sleep_time_mean_sleep < 700) %>%
  rename(`Head` = Hippocampal_head) %>%
  rename(`Tail` = Hippocampal_tail) %>%
  rename(`Sleep duration` = sleep_time_mean_sleep) %>%
  rename(`Acrophase` = actphi) %>%
  melt(id.vars = c('record_id', 'Group', 'IS', 'Sleep duration', 'Acrophase'), measure.vars = c('Head', 'Tail'), variable.name = 'Hippocampal region', value.name = 'Hippocampal subregion volume') %>%
  ggplot(aes(x = Acrophase, y = `Hippocampal subregion volume`, group = Group, color = Group)) +
  geom_point() + 
  stat_smooth(method = "lm", formula = 'y ~ x') +
  scale_color_brewer(palette = 'Set1') + theme_minimal() + 
  facet_grid(. ~ `Hippocampal region`, scales = 'free') + 
  theme(legend.position="none") +
  theme_minimal()
```

## Discussion
- Did not identify evidence of a long-axis encoding/retrieval differentiation using either of our episodic memory tasks
- Among older adults, greater hippocampal head volume was associated with greater associative memory accuracy during test. 
- Acrophase was also associated with greater associative memory accuracy during test, consistent with ([Ming Yi Lee et al., 2021](https://doi.org/10.1016/j.nbscr.2021.100065)) which recently found that older adults with delayed acrophase were less likely to have better cognition
- But, acrophase was not associated with hippocampal head volume
- No other selected sleep measures (mean sleep duration, rhythm amplitude, interdaily stability, acrophase) were  associated with hippocampal volume at conventional statistical thresholds.
- Did not see any relationship with CVLT performance in contrast to prior literature.

## Limitations
- Lack of CVLT-II data for young adult group prevented examination of different components of memory across adult development
- Hoped to partially overcome this limitation by evaluating relationships between hippocampal volume and aspects of performance on an associative memory task. This task provided behavioral measures much narrower in scope compared to the CVLT-II, with instead only measures of initial encoding and short-term recall. 
- Participants across both age groups performed well on this task, making it difficult to tease out functional variability.
- Healthy group not representative of "normal" aging
- Cross-sectional nature of the study may have prevented us from picking up on the key features of sleep that are important markers of cognitive health. Maybe the trajectories of these sleep patterns rather than their raw values are more revealing about the expected status of an individual’s cognitive performance and underlying brain health.



# All analyses below
## Hippocampal volume and associative memory 
- Excluded participants below chance accuracy

```{r, echo = FALSE, warning=FALSE}
dmem %>%
  filter(acc_mean.test > 0.50) %>%
  filter(memrepeat_accuracy > 0.50) %>%
  filter(acc_mean.learning > 0.33) %>%
  rename(`Head` = Hippocampal_head) %>%
  rename(`Tail` = Hippocampal_tail) %>%
  melt(id.vars = c('record_id', 'Group', 'acc_mean.learning'), measure.vars = c('Head', 'Tail'), variable.name = 'Hippocampal region', value.name = 'Hippocampal subregion volume') %>%
  ggplot(aes(x = `Hippocampal subregion volume`, y = acc_mean.learning, group = Group, color = Group)) +
  geom_point() + 
  stat_smooth(method = "lm", formula = 'y ~ x') +
  facet_grid(. ~ `Hippocampal region`, scales = 'free_x') + 
  scale_color_brewer(palette = 'Set1') + theme_minimal() + 
  ylab("Accuracy") + ggtitle("Learning phase")

dmem %>%
  filter(acc_mean.test > 0.50) %>%
  filter(memrepeat_accuracy > 0.50) %>%
  filter(acc_mean.learning > 0.33) %>%
  rename(`Head` = Hippocampal_head) %>%
  rename(`Tail` = Hippocampal_tail) %>%
  melt(id.vars = c('record_id', 'Group', 'rt_c_mean.learning'), measure.vars = c('Head', 'Tail'), variable.name = 'Hippocampal region', value.name = 'Hippocampal subregion volume') %>%
  ggplot(aes(x = `Hippocampal subregion volume`, y = rt_c_mean.learning, group = Group, color = Group)) +
  geom_point() + 
  stat_smooth(method = "lm", formula = 'y ~ x') +
  facet_grid(. ~ `Hippocampal region`, scales = 'free_x') + 
  scale_color_brewer(palette = 'Set1') + theme_minimal() + 
  ylab("Response time on correct trials") + ggtitle("Learning phase")

# memmatch
dmem %>%
  filter(acc_mean.test > 0.50) %>%
  filter(memrepeat_accuracy > 0.50) %>%
  filter(acc_mean.learning > 0.33) %>%
  rename(`Head` = Hippocampal_head) %>%
  rename(`Tail` = Hippocampal_tail) %>%
  melt(id.vars = c('record_id', 'Group', 'acc_mean.test'), measure.vars = c('Head', 'Tail'), variable.name = 'Hippocampal region', value.name = 'Hippocampal subregion volume') %>%
  ggplot(aes(x = `Hippocampal subregion volume`, y = acc_mean.test, group = Group, color = Group)) +
  geom_point() + 
  stat_smooth(method = "lm", formula = 'y ~ x') +
  facet_grid(. ~ `Hippocampal region`, scales = 'free_x') + 
  scale_color_brewer(palette = 'Set1') + theme_minimal() + 
  ylab("Accuracy") + ggtitle("Test phase")

dmem %>%
  filter(acc_mean.test > 0.50) %>%
  filter(memrepeat_accuracy > 0.50) %>%
  filter(acc_mean.learning > 0.33) %>%
  rename(`Head` = Hippocampal_head) %>%
  rename(`Tail` = Hippocampal_tail) %>%
  melt(id.vars = c('record_id', 'Group', 'rt_c_mean.test'), measure.vars = c('Head', 'Tail'), variable.name = 'Hippocampal region', value.name = 'Hippocampal subregion volume') %>%
  ggplot(aes(x = `Hippocampal subregion volume`, y = rt_c_mean.test, group = Group, color = Group)) +
  geom_point() + 
  stat_smooth(method = "lm", formula = 'y ~ x') +
  facet_grid(. ~ `Hippocampal region`, scales = 'free_x') + 
  scale_color_brewer(palette = 'Set1') + theme_minimal() + 
  ylab("Response time on correct trials") + ggtitle("Test phase")

## by condition

### match/mismatch
dmem %>%
  filter(acc_mean.test > 0.50) %>%
  filter(memrepeat_accuracy > 0.50) %>%
  filter(acc_mean.learning > 0.33) %>%
  rename(`Head` = Hippocampal_head) %>%
  rename(`Tail` = Hippocampal_tail) %>%
  melt(id.vars = c('record_id', 'Group', 'accuracy.match', 'accuracy.mismatch'), measure.vars = c('Head', 'Tail'), variable.name = 'Hippocampal region', value.name = 'Hippocampal subregion volume') %>%
  melt(id.vars = c('record_id', 'Group', 'Hippocampal region', 'Hippocampal subregion volume'), measure.vars = c('accuracy.match', 'accuracy.mismatch'), variable.name = 'Trial type', value.name = 'Accuracy') %>%
  ggplot(aes(x = `Hippocampal subregion volume`, y = Accuracy, group = Group, color = Group)) +
  geom_point() + 
  stat_smooth(method = "lm", formula = 'y ~ x') +
  facet_grid(`Trial type` ~ `Hippocampal region`, scales = 'free_x') + 
  scale_color_brewer(palette = 'Set1') + theme_minimal() + 
  ylab("Accuracy") + ggtitle("Test phase performance by trial type")

dmem %>%
  filter(acc_mean.test > 0.50) %>%
  filter(memrepeat_accuracy > 0.50) %>%
  filter(acc_mean.learning > 0.33) %>%
  rename(`Head` = Hippocampal_head) %>%
  rename(`Tail` = Hippocampal_tail) %>%
  melt(id.vars = c('record_id', 'Group', 'rt_c.match', 'rt_c.mismatch'), measure.vars = c('Head', 'Tail'), variable.name = 'Hippocampal region', value.name = 'Hippocampal subregion volume') %>%
  melt(id.vars = c('record_id', 'Group', 'Hippocampal region', 'Hippocampal subregion volume'), measure.vars = c('rt_c.match', 'rt_c.mismatch'), variable.name = 'Trial type', value.name = 'rt_c') %>%
  ggplot(aes(x = `Hippocampal subregion volume`, y = rt_c, group = Group, color = Group)) +
  geom_point() + 
  stat_smooth(method = "lm", formula = 'y ~ x') +
  facet_grid(`Trial type` ~ `Hippocampal region`, scales = 'free_x') + 
  scale_color_brewer(palette = 'Set1') + theme_minimal() + 
  ylab("Response time on correct trials") + ggtitle("Test phase performance by trial type")

# memrepeat

dmem %>%
  filter(acc_mean.test > 0.50) %>%
  filter(memrepeat_accuracy > 0.50) %>%
  filter(acc_mean.learning > 0.33) %>%
  rename(`Head` = Hippocampal_head) %>%
  rename(`Tail` = Hippocampal_tail) %>%
  melt(id.vars = c('record_id', 'Group', 'memrepeat_accuracy'), measure.vars = c('Head', 'Tail'), variable.name = 'Hippocampal region', value.name = 'Hippocampal subregion volume') %>%
  ggplot(aes(x = `Hippocampal subregion volume`, y = memrepeat_accuracy, group = Group, color = Group)) +
  geom_point() + 
  stat_smooth(method = "lm", formula = 'y ~ x') +
  facet_grid(. ~ `Hippocampal region`, scales = 'free_x') + 
  scale_color_brewer(palette = 'Set1') + theme_minimal() + 
  ylab("Response time on all trials") + ggtitle("Recognition task")

dmem %>%
  filter(acc_mean.test > 0.50) %>%
  filter(memrepeat_accuracy > 0.50) %>%
  filter(acc_mean.learning > 0.33) %>%
  rename(`Head` = Hippocampal_head) %>%
  rename(`Tail` = Hippocampal_tail) %>%
  melt(id.vars = c('record_id', 'Group', 'memrepeat_rt'), measure.vars = c('Head', 'Tail'), variable.name = 'Hippocampal region', value.name = 'Hippocampal subregion volume') %>%
  ggplot(aes(x = `Hippocampal subregion volume`, y = memrepeat_rt, group = Group, color = Group)) +
  geom_point() + 
  stat_smooth(method = "lm", formula = 'y ~ x') +
  facet_grid(. ~ `Hippocampal region`, scales = 'free_x') + 
  scale_color_brewer(palette = 'Set1') + theme_minimal() + 
  ylab("Response time") + ggtitle("Recognition task")


```

## Sleep 

```{r, echo=FALSE, warning=FALSE}
d %>%
  ggplot(aes(x = Group, y = IS, fill = Group, group = Group)) +
  geom_violin() +
  scale_fill_brewer(palette = 'Set1') + 
  ylab("Interdaily Stability")

d %>%
  ggplot(aes(x = Group, y = actphi, fill = Group, group = Group)) +
  geom_violin() +
  scale_fill_brewer(palette = 'Set1') + 
  ylab("Acrophase")

d %>%
  ggplot(aes(x = Group, y = sleep_time_mean_sleep, fill = Group, group = Group)) +
  geom_violin() +
  scale_fill_brewer(palette = 'Set1') + 
  ylab("Mean Sleep Time")

```

## Sleep and hippocampal volume

```{r}
dmem %>%
  rename(`Head` = Hippocampal_head) %>%
  rename(`Tail` = Hippocampal_tail) %>%
  rename(`Sleep duration` = sleep_time_mean_sleep) %>%
  rename(`Acrophase` = actphi) %>%
  melt(id.vars = c('record_id', 'Group', 'IS', 'Sleep duration', 'Acrophase'), measure.vars = c('Head', 'Tail'), variable.name = 'Hippocampal region', value.name = 'Hippocampal subregion volume') %>%
  melt(id.vars = c('record_id', 'Group', 'Hippocampal region', 'Hippocampal subregion volume'), measure.vars = c('IS', 'Sleep duration', 'Acrophase'), variable.name = 'Rest-Activity measure', value.name = 'value') %>%
  ggplot(aes(x = `Hippocampal subregion volume`, y = value, group = Group, color = Group)) +
  geom_point() + 
  stat_smooth(method = "lm", formula = 'y ~ x') +
  facet_grid(`Rest-Activity measure` ~ `Hippocampal region`, scales = 'free') + 
  scale_color_brewer(palette = 'Set1') + theme_minimal() + 
  theme(legend.position="none") +
  theme_minimal()
```


## Sleep and cognition

```{r, echo = FALSE, warning = FALSE}

dmem <- dmem %>%
  filter(sleep_time_mean_sleep < 750)

dmem$sleepundersix <- factor(dmem$sleepundersix, levels = c("Under 6 h", "At least 6 h"))

dmem %>%
  drop_na(sleepundersix) %>%
  ggplot(aes(x = Group, y = acc_mean.learning, group = Group, fill = Group)) +
  geom_violin() + 
  facet_grid(. ~ sleepundersix) + 
  scale_fill_brewer(palette = 'Set1')

## associative memory task

### sleep duration
dmem %>%
  filter(sleep_time_mean_sleep < 700) %>%
  melt(id.vars = c('record_id', 'Group', 'acc_mean.learning', 'acc_mean.test', 'memrepeat_accuracy', 'sleep_time_mean_sleep', 'actphi'), measure.vars = c('acc_mean.learning', 'acc_mean.test', 'memrepeat_accuracy'), variable.name = 'Task Phase', value.name = 'Accuracy') %>%
  mutate(`Task Phase` =  factor(`Task Phase`, labels = c("Learning", "Test", "Repeat"))) %>%
  ggplot(aes(x = sleep_time_mean_sleep, y = Accuracy, group = Group, color = Group)) +
  geom_point() + 
  stat_smooth(method = "lm", formula = 'y ~ x') +
  facet_grid(. ~ `Task Phase`, scales = 'free') + 
  scale_color_brewer(palette = 'Set1') + theme_minimal() + 
  xlab("Mean Sleep Duration (min)")

dmem %>%
  filter(sleep_time_mean_sleep < 700) %>%
  filter(rt_c_mean.learning < 6000) %>%
  melt(id.vars = c('record_id', 'Group', 'rt_c_mean.learning', 'rt_c_mean.test', 'memrepeat_rt', 'sleep_time_mean_sleep', 'actphi'), measure.vars = c('rt_c_mean.learning', 'rt_c_mean.test', 'memrepeat_rt'), variable.name = 'Task Phase', value.name = 'Response Time') %>%
  mutate(`Task Phase` =  factor(`Task Phase`, labels = c("Learning", "Test", "Repeat"))) %>%
  ggplot(aes(x = sleep_time_mean_sleep, y = `Response Time`, group = Group, color = Group)) +
  geom_point() + 
  stat_smooth(method = "lm", formula = 'y ~ x') +
  facet_grid(. ~ `Task Phase`, scales = 'free') + 
  scale_color_brewer(palette = 'Set1') + theme_minimal() + 
  xlab("Mean Sleep Duration (min)")

### acrophase
dmem %>%
  melt(id.vars = c('record_id', 'Group', 'acc_mean.learning', 'acc_mean.test', 'memrepeat_accuracy', 'sleep_time_mean_sleep', 'actphi'), measure.vars = c('acc_mean.learning', 'acc_mean.test', 'memrepeat_accuracy'), variable.name = 'Task Phase', value.name = 'Accuracy') %>%
  mutate(`Task Phase` =  factor(`Task Phase`, labels = c("Learning", "Test", "Repeat"))) %>%
  ggplot(aes(x = actphi, y = Accuracy, group = Group, color = Group)) +
  geom_point() + 
  stat_smooth(method = "lm", formula = 'y ~ x') +
  facet_grid(. ~ `Task Phase`, scales = 'free') + 
  scale_color_brewer(palette = 'Set1') + theme_minimal() + 
  xlab("Acrophase")

dmem %>%
  filter(sleep_time_mean_sleep < 700) %>%
  filter(rt_c_mean.learning < 6000) %>%
  melt(id.vars = c('record_id', 'Group', 'rt_c_mean.learning', 'rt_c_mean.test', 'memrepeat_rt', 'sleep_time_mean_sleep', 'actphi'), measure.vars = c('rt_c_mean.learning', 'rt_c_mean.test', 'memrepeat_rt'), variable.name = 'Task Phase', value.name = 'Response Time') %>%
  mutate(`Task Phase` =  factor(`Task Phase`, labels = c("Learning", "Test", "Repeat"))) %>%
  ggplot(aes(x = actphi, y = `Response Time`, group = Group, color = Group)) +
  geom_point() + 
  stat_smooth(method = "lm", formula = 'y ~ x') +
  facet_grid(. ~ `Task Phase`, scales = 'free') + 
  scale_color_brewer(palette = 'Set1') + theme_minimal() + 
  xlab("Acrophase")

### IS
dmem %>%
  melt(id.vars = c('record_id', 'Group', 'acc_mean.learning', 'acc_mean.test', 'memrepeat_accuracy', 'sleep_time_mean_sleep', 'IS'), measure.vars = c('acc_mean.learning', 'acc_mean.test', 'memrepeat_accuracy'), variable.name = 'Task Phase', value.name = 'Accuracy') %>%
  mutate(`Task Phase` =  factor(`Task Phase`, labels = c("Learning", "Test", "Repeat"))) %>%
  ggplot(aes(x = IS, y = Accuracy, group = Group, color = Group)) +
  geom_point() + 
  stat_smooth(method = "lm", formula = 'y ~ x') +
  facet_grid(. ~ `Task Phase`, scales = 'free') + 
  scale_color_brewer(palette = 'Set1') + theme_minimal()

dmem %>%
  filter(sleep_time_mean_sleep < 700) %>%
  filter(rt_c_mean.learning < 6000) %>%
  melt(id.vars = c('record_id', 'Group', 'rt_c_mean.learning', 'rt_c_mean.test', 'memrepeat_rt', 'sleep_time_mean_sleep', 'IS'), measure.vars = c('rt_c_mean.learning', 'rt_c_mean.test', 'memrepeat_rt'), variable.name = 'Task Phase', value.name = 'Response Time') %>%
  mutate(`Task Phase` =  factor(`Task Phase`, labels = c("Learning", "Test", "Repeat"))) %>%
  ggplot(aes(x = IS, y = `Response Time`, group = Group, color = Group)) +
  geom_point() + 
  stat_smooth(method = "lm", formula = 'y ~ x') +
  facet_grid(. ~ `Task Phase`, scales = 'free') + 
  scale_color_brewer(palette = 'Set1') + theme_minimal()


## cvlt
dmem %>%
  filter(sleep_time_mean_sleep < 700) %>%
  melt(id.vars = c('record_id', 'Group', 'cvlt_1', 'cvlt_sdelay_recall', 'cvlt_ldelay_recall', 'cvlt_recognition_hits', 'sleep_time_mean_sleep', 'actphi'), measure.vars = c('cvlt_1', 'cvlt_sdelay_recall', 'cvlt_ldelay_recall', 'cvlt_recognition_hits'), variable.name = 'CVLT Measure', value.name = 'Raw Score') %>%
  ggplot(aes(x = sleep_time_mean_sleep, y = `Raw Score`, group = Group, color = Group)) +
  geom_point() + 
  stat_smooth(method = "lm", formula = 'y ~ x') +
  facet_grid(. ~ `CVLT Measure`, scales = 'free') + 
  scale_color_brewer(palette = 'Set1') + theme_minimal() + 
  xlab("Mean Sleep Duration (min)")

dmem %>%
  melt(id.vars = c('record_id', 'Group', 'cvlt_1', 'cvlt_sdelay_recall', 'cvlt_ldelay_recall', 'cvlt_recognition_hits', 'sleep_time_mean_sleep', 'actphi'), measure.vars = c('cvlt_1', 'cvlt_sdelay_recall', 'cvlt_ldelay_recall', 'cvlt_recognition_hits'), variable.name = 'CVLT Measure', value.name = 'Raw Score') %>%
  ggplot(aes(x = actphi, y = `Raw Score`, group = Group, color = Group)) +
  geom_point() + 
  stat_smooth(method = "lm", formula = 'y ~ x') +
  facet_grid(. ~ `CVLT Measure`, scales = 'free') + 
  scale_color_brewer(palette = 'Set1') + theme_minimal() + 
  xlab("Acrophase")

```

```{r corplots, include = FALSE, echo = FALSE, warning=FALSE}

dmem %>%
  select(actamp, sleep_time_mean_sleep, actmin, duration_mean_active, cvlt_1, cvlt_sdelay_recall_zscore, cvlt_ldelay_recall_zscore, cvlt_recognition_hits_zscore) %>%
  correlate() %>%
  rplot(print_cor = TRUE) + theme(axis.text.x = element_text(angle = 90)) +
  ggtitle("Sleep and CVLT task performance")

dmem %>%
  select(actamp, sleep_time_mean_sleep, actmin, duration_mean_active, acc_mean.learning, acc_mean.test, rt_c_mean.learning, rt_c_mean.test) %>%
  correlate() %>%
  rplot(print_cor = TRUE) + theme(axis.text.x = element_text(angle = 90)) +
  ggtitle("Sleep and associative memory task performance")

dmem %>%
  ggplot(aes(x = actamp, y = acc_mean.learning, color = Group)) +
  geom_point() +
  stat_smooth(method = 'lm') + scale_color_brewer(palette = 'Set1') + theme_minimal()

dmem %>%
  ggplot() +
  geom_point(aes(x = actamp, y = rt_c_mean.learning, color = Group)) +
  stat_smooth(aes(x = actamp, y = rt_c_mean.learning), method = 'lm') + scale_color_brewer(palette = 'Set1') + theme_minimal()

dmem %>%
  ggplot(aes(x = actamp, y = acc_mean.test, group = Group, color = Group)) +
  geom_point() +
  stat_smooth(method = 'lm') + scale_color_brewer(palette = 'Set1') + theme_minimal()

dmem %>%
  ggplot(aes(x = actamp, y = rt_c_mean.test, group = Group, color = Group)) +
  geom_point() +
  stat_smooth(method = 'lm') + scale_color_brewer(palette = 'Set1') + theme_minimal()
```

## Stats

```{r vol_stats}

dmem2 <- dmem %>%
  filter(acc_mean.test > 0.50) %>%
  filter(acc_mean.learning > 0.33)

## learning

summary(lm(acc_mean.learning ~ Hippocampal_head * Group, data = dmem2)) 
summary(lm(acc_mean.learning ~ Hippocampal_head + Group, data = dmem2))

summary(lm(rt_c_mean.learning ~ Hippocampal_head * Group, data = dmem2))
summary(lm(rt_c_mean.learning ~ Hippocampal_head + Group, data = dmem2)) 

summary(lm(acc_mean.learning ~ Hippocampal_tail * Group, data = dmem2))
summary(lm(acc_mean.learning ~ Hippocampal_tail + Group, data = dmem2))

summary(lm(rt_c_mean.learning ~ Hippocampal_tail * Group, data = dmem2))
summary(lm(rt_c_mean.learning ~ Hippocampal_tail + Group, data = dmem2))

## test

summary(lm(acc_mean.test ~ Hippocampal_head * Group, data = dmem2)) 
summary(lm(acc_mean.test ~ Hippocampal_head + Group, data = dmem2)) 

summary(lm(rt_c_mean.test ~ Hippocampal_head * Group, data = dmem2))
summary(lm(rt_c_mean.test ~ Hippocampal_head + Group, data = dmem2)) 

summary(lm(acc_mean.test ~ Hippocampal_tail * Group, data = dmem2))
summary(lm(acc_mean.test ~ Hippocampal_tail + Group, data = dmem2)) 

summary(lm(rt_c_mean.test ~ Hippocampal_tail * Group, data = dmem2)) 
summary(lm(rt_c_mean.test ~ Hippocampal_tail + Group, data = dmem2)) 


## trial type

summary(lm(accuracy.mismatch ~  Hippocampal_head * Group, data = dmem)) 
summary(lm(accuracy.match ~ Hippocampal_head + Group, data = dmem)) 

summary(lm(accuracy.mismatch ~  Hippocampal_tail + Group, data = dmem)) 
summary(lm(accuracy.match ~ Hippocampal_head + Group, data = dmem)) 

## recognition

summary(lm(memrepeat_accuracy ~ Hippocampal_head * Group, data = dmem2))
summary(lm(memrepeat_accuracy ~ Hippocampal_head + Group, data = dmem2)) 

summary(lm(memrepeat_accuracy ~ Hippocampal_tail * Group, data = dmem2))
summary(lm(memrepeat_accuracy ~ Hippocampal_tail + Group, data = dmem2))

summary(lm(memrepeat_rt ~ Hippocampal_head * Group, data = dmem2))
summary(lm(memrepeat_rt ~ Hippocampal_head + Group, data = dmem2)) 

summary(lm(memrepeat_rt ~ Hippocampal_tail * Group, data = dmem2)) 
summary(lm(memrepeat_rt ~ Hippocampal_tail + Group, data = dmem2)) 

```


```{r}
summary(lm(Hippocampal_head ~ sleep_time_mean_sleep + Group, data = dmem2))
summary(lm(Hippocampal_tail ~ sleep_time_mean_sleep + Group, data = dmem2))

summary(lm(Hippocampal_tail ~ actphi * Group, data = dmem2))
summary(lm(Hippocampal_head ~ actphi + Group, data = dmem2))
summary(lm(Hippocampal_tail ~ actphi + Group, data = dmem2))

summary(lm(Hippocampal_head ~ IS + Group, data = dmem2))
summary(lm(Hippocampal_tail ~ IS + Group, data = dmem2))

```


```{r sleep_stats}
## cvlt
summary(lm(cvlt_1 ~ sleep_time_mean_sleep + age, data = filter(dmem2, Group == "Older Adults")))
summary(lm(cvlt_sdelay_recall ~ sleep_time_mean_sleep + age, data = filter(dmem2, Group == "Older Adults")))
summary(lm(cvlt_ldelay_recall ~ sleep_time_mean_sleep + age, data = filter(dmem2, Group == "Older Adults")))
summary(lm(cvlt_recognition_hits ~ sleep_time_mean_sleep + age, data = filter(dmem2, Group == "Older Adults")))

summary(lm(cvlt_1 ~ IS, data = filter(dmem2, Group == "Older Adults")))
summary(lm(cvlt_sdelay_recall ~ IS, data = filter(dmem2, Group == "Older Adults")))
summary(lm(cvlt_ldelay_recall ~ IS, data = filter(dmem2, Group == "Older Adults")))
summary(lm(cvlt_recognition_hits ~ IS, data = filter(dmem2, Group == "Older Adults"))) #

summary(lm(cvlt_1 ~ actphi, data = filter(dmem2, Group == "Older Adults")))
summary(lm(cvlt_sdelay_recall ~ actphi, data = filter(dmem2, Group == "Older Adults")))
summary(lm(cvlt_ldelay_recall ~ actphi, data = filter(dmem2, Group == "Older Adults")))
summary(lm(cvlt_recognition_hits ~ actphi, data = filter(dmem2, Group == "Older Adults")))

t.test(acc_mean.test ~ sleepundersix, data = filter(dmem2, Group == "Older Adults"))
t.test(rt_c_mean.test ~ sleepundersix, data = filter(dmem2, Group == "Older Adults"))
t.test(cvlt_ldelay_recall ~ sleepundersix, data = filter(dmem2, Group == "Older Adults"))
t.test(cvlt_recognition_hits ~ sleepundersix, data = filter(dmem2, Group == "Older Adults"))

## sleep time
summary(lm(acc_mean.learning ~ sleep_time_mean_sleep * Group, data = dmem2))
summary(lm(acc_mean.learning ~ sleep_time_mean_sleep + Group, data = dmem2))
summary(lm(rt_c_mean.learning~ sleep_time_mean_sleep * Group, data = dmem2))
summary(lm(rt_c_mean.learning~ sleep_time_mean_sleep + Group, data = dmem2))

summary(lm(acc_mean.test~ sleep_time_mean_sleep * Group, data = dmem2))
summary(lm(acc_mean.test~ sleep_time_mean_sleep + Group, data = dmem2))

summary(lm(rt_c_mean.test ~ sleep_time_mean_sleep * Group, data = dmem2))
summary(lm(rt_c_mean.test ~ sleep_time_mean_sleep + Group, data = dmem2))

summary(lm(memrepeat_accuracy ~ sleep_time_mean_sleep * Group, data = dmem2)) 
summary(lm(memrepeat_accuracy ~ sleep_time_mean_sleep + Group, data = dmem2)) 

summary(lm(memrepeat_rt ~ sleep_time_mean_sleep * Group, data = dmem2))
summary(lm(memrepeat_rt ~ sleep_time_mean_sleep + Group, data = dmem2)) 

# acrophase
summary(lm(acc_mean.learning ~ actphi * Group, data = dmem2))
summary(lm(acc_mean.learning ~ actphi + Group, data = dmem2))

summary(lm(rt_c_mean.learning~ actphi * Group, data = dmem2))
summary(lm(rt_c_mean.learning~ actphi + Group, data = dmem2))

summary(lm(acc_mean.test~ actphi * Group, dmem2))
summary(lm(acc_mean.test~ actphi + Group, dmem2))

summary(lm(rt_c_mean.test ~ actphi * Group, dmem2))
summary(lm(rt_c_mean.test ~ actphi + Group, dmem2))

summary(lm(memrepeat_accuracy ~ actphi * Group, data = dmem2)) 
summary(lm(memrepeat_accuracy ~ actphi + Group, data = dmem2)) 

summary(lm(memrepeat_rt ~ actphi * Group, data = dmem2))
summary(lm(memrepeat_rt ~ actphi + Group, data = dmem2))

# IS
summary(lm(acc_mean.learning ~ IS * Group, data = dmem2))
summary(lm(acc_mean.learning ~ IS + Group, data = dmem2))

summary(lm(rt_c_mean.learning~ IS * Group, data = dmem2))
summary(lm(rt_c_mean.learning~ IS + Group, data = dmem2))

summary(lm(acc_mean.test~ IS * Group, dmem2))
summary(lm(acc_mean.test~ IS + Group, dmem2))

summary(lm(rt_c_mean.test ~ IS * Group, dmem2))
summary(lm(rt_c_mean.test ~ IS + Group, dmem2))

summary(lm(memrepeat_accuracy ~ IS * Group, data = dmem2)) 
summary(lm(memrepeat_accuracy ~ IS + Group, data = dmem2)) 

summary(lm(memrepeat_rt ~ IS * Group, data = dmem2))
summary(lm(memrepeat_rt ~ IS + Group, data = dmem2)) 
```

```{r, include = FALSE, warning=FALSE}
fs <- read.csv('/Users/mcmahonmc/Box/CogNeuroLab/Aging Decision Making R01/Data/memmatch_learning_face-scene_results_mean.csv', skip =2, col.names = c('X0', 'phase', 'record_id', 'face_scene', 'acc_mean', 'acc_std', 'rt_mean', 'rt_std', 'rt_c_mean', 'rt_c_std'))

fs$face_scene <- ifelse(fs$face_scene == 0, 'face', 'scene')

fswide <- fs %>%
  pivot_wider(
    id_cols = record_id,
    names_from = c('phase', 'face_scene'),
    names_sep = ".",
    values_from = c(acc_mean, acc_std, rt_mean, rt_std, rt_c_mean, rt_c_std)
  )

```

```{r, include = FALSE, warning=FALSE}
dmem2 <- merge(dmem, fswide, by = 'record_id')

dmem2 %>%
  ggplot(aes(x = Hippocampal_head, y = 
acc_mean.learning.scene, group = Group, color = Group)) +
  geom_point() +
  stat_smooth(method = 'lm') + scale_color_brewer(palette = 'Set1') + theme_minimal()

dmem2 %>%
  ggplot(aes(x = Hippocampal_head, y = 
acc_mean.learning.face, group = Group, color = Group)) +
  geom_point() +
  stat_smooth(method = 'lm') + scale_color_brewer(palette = 'Set1') + theme_minimal()

dmem2 %>%
  ggplot(aes(x = Hippocampal_tail, y = 
acc_mean.learning.scene, group = Group, color = Group)) +
  geom_point() +
  stat_smooth(method = 'lm') + scale_color_brewer(palette = 'Set1') + theme_minimal()

dmem2 %>%
  ggplot(aes(x = Hippocampal_tail, y = 
acc_mean.learning.face, group = Group, color = Group)) +
  geom_point() +
  stat_smooth(method = 'lm') + scale_color_brewer(palette = 'Set1') + theme_minimal()

dmem2 %>%
  ggplot(aes(x = Hippocampal_head, y = 
acc_mean.test.scene, group = Group, color = Group)) +
  geom_point() +
  stat_smooth(method = 'lm') + scale_color_brewer(palette = 'Set1') + theme_minimal()

dmem2 %>%
  ggplot(aes(x = Hippocampal_head, y = 
acc_mean.test.face, group = Group, color = Group)) +
  geom_point() +
  stat_smooth(method = 'lm') + scale_color_brewer(palette = 'Set1') + theme_minimal()

dmem2 %>%
  ggplot(aes(x = Hippocampal_tail, y = 
acc_mean.test.scene, group = Group, color = Group)) +
  geom_point() +
  stat_smooth(method = 'lm') + scale_color_brewer(palette = 'Set1') + theme_minimal()

dmem2 %>%
  ggplot(aes(x = Hippocampal_tail, y = 
acc_mean.test.face, group = Group, color = Group)) +
  geom_point() +
  stat_smooth(method = 'lm') + scale_color_brewer(palette = 'Set1') + theme_minimal()
```


